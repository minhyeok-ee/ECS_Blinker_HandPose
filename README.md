# ECS Blinker System

**202100319 장민혁**

---

## 작동 영상 링크

[![유튜브 썸네일](https://img.youtube.com/vi/MYyBEV7Se1Y/0.jpg)](https://www.youtube.com/watch?v=MYyBEV7Se1Y)

---

## 📌 프로젝트 개요

이번 프로젝트에서는 **신호등의 REAL-TIME SYSTEM을 구축**하고,  
**인터럽트가 발생하면 즉시 동작을 변경할 수 있는 시스템**을 설계하는 활동을 진행했습니다.

또한 이번 주에는 **웹캠 기반 제스처 인식 기능을 추가하여**,  
**사용자의 손동작만으로 신호등 상태를 제어할 수 있는 인터랙티브 시스템**을 구현했습니다.

이 시스템은 **세 가지 작동 모드**를 지원하며, **가변저항을 통해 LED 밝기 조절**이 가능합니다.  
추가적으로, **제스처 인식을 통해 모드 전환 및 특정 상태 제어도 가능**하게 확장하였습니다.

---

## ⚡ 회로 구성

| 구성 요소   | 핀 번호     |
| ----------- | ----------- |
| 🔴 빨간 LED | DIGITAL 11  |
| 🟡 노란 LED | DIGITAL 10  |
| 🟢 초록 LED | DIGITAL 9   |
| 🔘 버튼 1   | DIGITAL 2   |
| 🔘 버튼 2   | DIGITAL 3   |
| 🔘 버튼 3   | DIGITAL 4   |
| 🎛 가변저항  | 아날로그 A0 |

---

## 🔧 기능 설명

### 1️⃣ **기본 신호등 모드**

- 🚦 **자동 신호등 시스템**이 동작하며, 아래 순서대로 LED가 변경됨.
  1. **빨간불(RED) → 노란불(YELLOW) → 초록불(GREEN)**
  2. **초록불 깜빡임(GREEN_BLINK) → 노란불(YELLOW) → 빨간불(RED)**
- 각 상태는 정해진 시간 동안 유지됨.

### 2️⃣ **모드 변경 기능 (버튼 입력)**

각 버튼을 누르면 **신호등 모드가 즉시 변경**됨.

| 버튼                   | 동작                                 |
| ---------------------- | ------------------------------------ |
| 🔘 **버튼 1 (Mode 1)** | **빨간불 고정** 모드 (RED ONLY)      |
| 🔘 **버튼 2 (Mode 2)** | **모든 LED 깜빡임** 모드 (ALL BLINK) |
| 🔘 **버튼 3 (Mode 3)** | **모든 LED OFF** 모드 (ALL OFF)      |

버튼을 다시 누르면 기본 신호등 모드로 돌아감.

### 3️⃣ **LED 밝기 조절 (가변저항 A0 활용)**

- 가변저항을 돌리면 **출력 전압 (0~5V) 변화**에 따라 LED 밝기가 조절됨.
- 밝기 값은 **실시간으로 시리얼 모니터에 출력됨**.

---

## ✋ 제스처 인식 기반 신호등 제어 기능 (추가내용)

이번 주에는 **웹캠을 활용한 제스처 인식 기능을 신호등 시스템에 통합**하였습니다.  
이 기능을 통해 **사용자는 손동작만으로 신호등의 작동 모드와 타이밍을 제어**할 수 있습니다.

### 🎯 제스처 매핑 기능

| 제스처         | 기능 설명                               |
| -------------- | --------------------------------------- |
| 👍 엄지 위로   | 모든 LED의 점등 시간 **증가**           |
| 👎 엄지 아래로 | 모든 LED의 점등 시간 **감소**           |
| ☝️ 손가락 1개  | **모드 1**: 빨간불 고정 (RED ONLY)      |
| ✌️ 손가락 2개  | **모드 2**: 모든 LED 깜빡임 (ALL BLINK) |
| 🤟 손가락 3개  | **모드 3**: 모든 LED OFF (ALL OFF)      |
| ✋ 손등 인식   | **기본 신호등 모드로 복귀**             |

각 제스처는 실시간으로 인식되며, 즉시 시스템에 반영됩니다.

### 🛠 기술 스택

- **MediaPipe Hands**: 손 제스처 인식용 머신러닝 라이브러리
- **JavaScript + HTML/CSS**: 프론트엔드 UI 및 제스처 처리
- **Web Serial API**: 제스처 결과를 아두이노로 전송
- **Arduino Uno**: LED 신호등 제어

### ⚙️ 동작 구조

1. 웹캠으로 사용자의 손동작을 실시간 감지
2. 인식된 제스처에 따라 특정 명령어 생성  
   (예: `"MODE1"`, `"TIME_UP"`, `"RESET"` 등)
3. 해당 명령을 **Web Serial API**를 통해 아두이노로 전송
4. 아두이노는 명령을 수신하여 신호등의 **모드, 타이밍, 상태**를 제어

---

## 🛠 코드 설명

### 🚦 **신호등 상태 (FSM, Finite State Machine)**

```cpp
enum TrafficState { RED_ON, YELLOW_ON, GREEN_ON, GREEN_HOLD, GREEN_BLINK, YELLOW2_ON };
```

FSM을 활용해 자동 신호등 시스템을 구현했으며, 각 상태는 정해진 시간 동안 유지됩니다.

- **RED_ON**: 빨간불 ON
- **YELLOW_ON**: 노란불 ON
- **GREEN_ON**: 초록불 ON
- **GREEN_HOLD**: 초록불 유지
- **GREEN_BLINK**: 초록불 깜빡임 (3회 반복)
- **YELLOW2_ON**: 초록불 깜빡임 이후 노란불 상태

FSM은 주기적으로 상태를 업데이트하며,  
**제스처나 버튼 입력이 들어오면 상태를 강제로 변경**할 수 있습니다.

---

### 🔘 인터럽트 기반 버튼 입력 처리

- `Pin Change Interrupt`를 사용해 버튼 누름을 감지하고, **모드 토글 방식**으로 작동합니다.
- 각 버튼은 Falling Edge(버튼을 눌렀을 때)에서 동작합니다.

| 버튼   | 동작 모드                           |
| ------ | ----------------------------------- |
| 버튼 1 | 모드 1: 빨간불 고정 (RED ONLY)      |
| 버튼 2 | 모드 2: 모든 LED 깜빡임 (ALL BLINK) |
| 버튼 3 | 모드 3: 모든 LED OFF (ALL OFF)      |

다시 누르면 기본 신호등 모드로 복귀됩니다.

---

### 🎛 가변저항을 통한 LED 밝기 조절

- 가변저항(A0)의 값을 이용하여 LED 밝기를 조절합니다.
- 입력값 (0~1023)을 PWM 신호로 변환하여 LED 밝기를 조정하고,  
  시리얼 모니터로 상태를 확인할 수 있습니다.

---

### 🤖 제스처 인식 기반 제어 (Web + Arduino 연동)

웹캠을 통해 손 제스처를 인식하고, 그 결과를 **Web Serial API**를 통해 아두이노로 전송합니다.  
이를 통해 **모드 전환, LED 점등 시간 조정** 등의 동작을 수행합니다.

#### 👆 제스처 인식 로직

- MediaPipe를 기반으로 손의 **관절 좌표(keypoints)** 를 인식
- 다음과 같은 로직으로 동작:

| 제스처 유형        | 인식 기준 설명                          | 동작 기능                   |
| ------------------ | --------------------------------------- | --------------------------- |
| 엄지 위로 (`👍`)   | 엄지만 위로, 나머지 손가락은 내림       | 모든 LED 점등 시간 **증가** |
| 엄지 아래로 (`👎`) | 엄지만 아래로, 나머지 손가락은 접음     | 모든 LED 점등 시간 **감소** |
| 손가락 1개 (`☝️`)  | 검지만 펴짐                             | 모드 1 (빨간불 고정)        |
| 손가락 2개 (`✌️`)  | 검지 + 중지만 펴짐                      | 모드 2 (LED 전체 깜빡임)    |
| 손가락 3개 (`🤟`)  | 검지 + 중지 + 약지 펴짐                 | 모드 3 (LED 전체 OFF)       |
| 손등 보이기 (`✋`) | 손가락 5개 다 펴고 손등이 카메라를 향함 | 기본 신호등 모드로 복귀     |

#### 📤 데이터 전송 형식

웹 코드에서 `"모드 번호, 빨간불 시간, 노란불 시간, 초록불 시간\n"` 형식의 문자열을 아두이노로 전송합니다.  
예시: `1,1000,1000,1500\n`

#### 🧠 주요 함수 설명

- `isOnlyThumbUp(kp)`: 엄지만 위로 들어올린 상태 인식
- `countExtendedFingers(kp)`: 펴진 손가락 개수 계산
- `isPalmFacing(hand)`: 손등이 카메라를 보고 있는지 판단
- `checkGesture()`: 위 조건을 바탕으로 현재 제스처 판별 및 명령 전송

#### 💻 UI 요소

- HTML 슬라이더(`redSlider`, `yellowSlider`, `greenSlider`)를 통해 점등 시간 수동 조정 가능
- 슬라이더 조작 시에도 아두이노로 동일한 방식으로 값 전송

---

### 🖥 시리얼 모니터 출력 예시

시리얼 모니터를 통해 현재 신호등의 상태와 LED 밝기를 실시간으로 확인할 수 있습니다.

예시 출력:

```c
LED: RED MODE: 1 Brightness: 3.6V
```

버튼 입력 또는 제스처 인식 결과에 따라 출력 값이 즉시 반영됩니다.

## 📌 프로젝트 요약

- ✅ Real-Time System 기반의 신호등 시스템 구축
- ✅ 인터럽트 활용하여 버튼 입력 처리
- ✅ FSM (Finite State Machine) 기반으로 신호등 동작
- ✅ 가변저항을 통한 LED 밝기 조절 기능 추가
- ✅ 시리얼 모니터 출력으로 LED 상태 확인 가능
- ✅ **MediaPipe 기반 제스처 인식 기능 추가 (웹캠 활용)**
- ✅ **Web Serial API를 통한 실시간 아두이노 연동**
- ✅ **제스처로 점등 시간 조절 및 모드 변경 기능 구현**

---
